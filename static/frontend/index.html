<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Wireless AI Assistant</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: #f0f4f8;
        margin: 0;
        padding: 0;
        min-height: 100vh;
      }
      .container {
        background: #fff;
        max-width: 600px;
        margin: 40px auto;
        box-shadow: 0 8px 32px 0 rgba(60, 60, 80, 0.11);
        border-radius: 18px;
        padding: 32px 28px 36px 28px;
      }
      h2 {
        text-align: center;
        color: #222a35;
        font-size: 2em;
        margin-bottom: 28px;
        letter-spacing: 1px;
      }
      label {
        display: block;
        margin-top: 16px;
        font-weight: 500;
        color: #385170;
        font-size: 1.08em;
      }
      input[type="number"],
      select {
        width: 100%;
        padding: 10px;
        margin-top: 7px;
        margin-bottom: 15px;
        border: 1.2px solid #bdd4e7;
        border-radius: 8px;
        font-size: 1em;
        background: #f7fafc;
        transition: border 0.2s;
      }
      input:focus,
      select:focus {
        border-color: #3e92cc;
        outline: none;
        background: #eaf6fb;
      }
      button {
        display: block;
        width: 100%;
        margin-top: 20px;
        background: linear-gradient(90deg, #2567c3 60%, #0db2de 100%);
        color: #fff;
        font-size: 1.13em;
        font-weight: 600;
        padding: 13px 0;
        border: none;
        border-radius: 8px;
        box-shadow: 0 4px 16px 0 rgba(60, 60, 80, 0.08);
        cursor: pointer;
        transition: background 0.22s;
      }
      button:hover,
      button:focus {
        background: linear-gradient(90deg, #174ea6 60%, #06a7c4 100%);
      }
      #response {
        margin-top: 32px;
        background: #e9f3fc;
        border-left: 6px solid #3e92cc;
        padding: 18px 18px 12px 18px;
        border-radius: 8px;
        color: #222a35;
        font-size: 1.12em;
        box-shadow: 0 1px 8px 0 rgba(60, 60, 80, 0.07);
        min-height: 30px;
        white-space: pre-wrap;
        word-break: break-word;
      }
      ul {
        margin-top: 10px;
        margin-bottom: 18px;
        padding-left: 24px;
      }
      ul li {
        margin-bottom: 4px;
      }
      .section-title {
        margin-bottom: 5px;
        font-size: 1.11em;
        color: #215176;
        font-weight: bold;
        letter-spacing: 0.02em;
      }
      .markdown {
        font-size: 1.06em;
        color: #1c2430;
      }
      .markdown h1,
      .markdown h2,
      .markdown h3 {
        margin: 1em 0 0.5em;
      }
      .markdown ul {
        margin-left: 24px;
      }
      .markdown li {
        margin-bottom: 5px;
      }
      .markdown strong {
        font-weight: bold;
      }
      .markdown em {
        font-style: italic;
      }
      @media (max-width: 650px) {
        .container {
          max-width: 97vw;
          padding: 12vw 3vw 12vw 3vw;
        }
        h2 {
          font-size: 1.3em;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Wireless & Mobile Networks: AI Assistant</h2>
      <label>
        Select scenario:
        <select id="scenario">
          <option value="wireless">Wireless Communication System</option>
          <option value="ofdm">OFDM System</option>
          <option value="link_budget">Link Budget Calculation</option>
          <option value="cellular">Cellular System Design</option>
        </select>
      </label>
      <form id="params-form"></form>
      <button onclick="submitForm()">Compute & Get AI Explanation</button>
      <div id="response"></div>
    </div>
    <script>
      const paramInputs = {
        wireless: [
          {
            name: "bandwidth_khz",
            label: "Signal bandwidth (kHz)",
            type: "number",
            step: "0.01",
          },
          {
            name: "bits_per_sample",
            label: "Bits per sample (Quantizer)",
            type: "number",
          },
          {
            name: "src_compression_rate",
            label: "Source encoder compression rate ",
            type: "number",
            step: "0.01",
          },
          {
            name: "channel_code_rate",
            label: "Channel code rate ",
            type: "number",
            step: "0.01",
          },
          {
            name: "burst_formatting_overhead",
            label: "Burst formatting overhead ",
            type: "number",
            step: "0.01",
          },
        ],
        ofdm: [
          {
            name: "rb_bandwidth_khz",
            label: "Resource block bandwidth (kHz)",
            type: "number",
          },
          {
            name: "subcarrier_spacing_khz",
            label: "Subcarrier spacing (kHz)",
            type: "number",
          },
          {
            name: "n_ofdm_symbols",
            label: "OFDM symbols per resource block",
            type: "number",
          },
          {
            name: "mod_order",
            label: "QAM modulation order (1024 for 1024-QAM)",
            type: "number",
          },
          {
            name: "rb_duration_ms",
            label: "Resource block duration (ms)",
            type: "number",
          },
          {
            name: "n_parallel_rbs",
            label: "Number of parallel RBs (for user e.g:  4)",
            type: "number",
          },
        ],
        link_budget: [
          { name: "tx_power_db", label: "Transmit Power (dB)", type: "number" },
          { name: "rx_power_db", label: "Received Power (dB)", type: "number" },
          {
            name: "tx_gain_db",
            label: "Transmitter antenna gain (dB)",
            type: "number",
          },
          {
            name: "tx_amplifier_gain_db",
            label: "Transmitter amplifier gain (dB)",
            type: "number",
          },
          {
            name: "tx_loss_db",
            label: "Transmitter cable/feed loss (dB)",
            type: "number",
          },
          {
            name: "rx_gain_db",
            label: "Receiver antenna gain (dB)",
            type: "number",
          },
          {
            name: "rx_amplifier_gain_db",
            label: "Receiver amplifier gain (dB)",
            type: "number",
          },
          {
            name: "rx_loss_db",
            label: "Receiver cable/feed loss (dB)",
            type: "number",
          },
          { name: "freq_mhz", label: "Frequency (MHz)", type: "number" },
          { name: "distance_m", label: "Distance (meters)", type: "number" },
          {
            name: "path_loss_db",
            label: "Direct Path Loss (dB)",
            type: "number",
          },
          { name: "other_loss_db", label: "Other losses (dB)", type: "number" },
          { name: "fade_margin_db", label: "Fade margin (dB)", type: "number" },
          { name: "data_rate_bps", label: "Data rate (bps)", type: "number" },
          {
            name: "noise_figure_db",
            label: "Noise Figure (dB)",
            type: "number",
          },
          {
            name: "noise_temp_K",
            label: "Noise Temperature (K)",
            type: "number",
          },
          {
            name: "required_ebn0_db",
            label: "Required Eb/N0 (dB)",
            type: "number",
          },
        ],
        cellular: [
          {
            name: "timeslots_per_carrier",
            label: "Timeslots per carrier ",
            type: "number",
          },
          { name: "area_km2", label: "Coverage area (m²)", type: "number" },
          {
            name: "n_users",
            label: "Total number of subscribers/users",
            type: "number",
          },
          {
            name: "call_rate",
            label: "Average calls per subscriber per day",
            type: "number",
            step: "0.01",
          },
          {
            name: "avg_call_duration_min",
            label: "Average call duration (minutes)",
            type: "number",
            step: "0.01",
          },
          {
            name: "min_sir_db",
            label: "Minimum SIR required (dB)",
            type: "number",
            step: "0.01",
          },
          {
            name: "ref_power_db",
            label: "Reference power at reference distance (dB)",
            type: "number",
            step: "0.01",
          },
          {
            name: "ref_distance_m",
            label: "Reference distance (meters)",
            type: "number",
            step: "0.01",
          },
          {
            name: "path_loss_exp",
            label: "Path loss exponent",
            type: "number",
            step: "0.01",
          },
          {
            name: "receiver_sensitivity_uw",
            label: "Receiver sensitivity (μW)",
            type: "number",
            step: "0.01",
          },
          {
            name: "cochannel_interferers",
            label: "Number of co-channel interfering cells",
            type: "number",
          },
          {
            name: "n_channels",
            label: "Number of channels (total)",
            type: "number",
          },
        ],
      };

      const scenarioSelect = document.getElementById("scenario");
      const paramsForm = document.getElementById("params-form");
      const responseDiv = document.getElementById("response");

      function renderForm() {
        const scenario = scenarioSelect.value;
        paramsForm.innerHTML = "";
        paramInputs[scenario].forEach((input) => {
          paramsForm.innerHTML += `
          <label>${input.label}<br>
            <input type="${input.type}" name="${input.name}" ${
            input.step ? (step = "${input.step}") : ""
          }>
          </label>
        `;
        });
      }

      renderForm();
      scenarioSelect.onchange = renderForm;

      function resultToHTML(scenario, result) {
        if (!result) return "";
        let html = `<div class="section-title">${scenario
          .replace("_", " ")
          .replace(/\b\w/g, (l) => l.toUpperCase())} Results:</div><ul>`;
        for (const [k, v] of Object.entries(result)) {
          html += `<li><b>${k.replace(/_/g, " ")}:</b> ${v}</li>`;
        }
        html += "</ul>";
        return html;
      }

      async function submitForm() {
        responseDiv.innerHTML = "Loading...";
        const scenario = scenarioSelect.value;
        const inputs = paramsForm.querySelectorAll("input");
        const params = {};
        for (const input of inputs) {
          if (!input.value) continue;
          params[input.name] = input.value;
        }
        try {
          const res = await fetch("/api/calculate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ scenario, params }),
          });
          if (!res.ok) throw new Error("Server error");
          const data = await res.json();
          responseDiv.innerHTML =
            resultToHTML(scenario, data.result) +
            `<div class="section-title">AI Explanation:</div><div class="markdown">${marked.parse(
              data.explanation
            )}</div>`;
        } catch (err) {
          responseDiv.innerHTML = "Error: " + err.message;
        }
      }
    </script>
  </body>
</html>
